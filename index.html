<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Suivi du Bus</title>
  <script>
    let userPosition = { lat: 36.75, lng: 3.05 }; // Position par défaut (ex. Alger)

    function markBusArrival() {
      // On envoie la position actuelle du passager au serveur
      const stopData = {
        name: "Passager1",  // Nom du passager (ici un exemple)
        time: new Date().toLocaleTimeString(),  // Heure actuelle
        lat: userPosition.lat,
        lng: userPosition.lng
      };

      fetch('https://script.google.com/macros/s/YOUR_SCRIPT_URL/exec', {
        method: 'POST',
        body: new URLSearchParams({ 
          action: 'markArrival', 
          stop: JSON.stringify(stopData)
        }),
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert("Bus marqué comme arrivé!");
        } else {
          alert("Erreur lors de l'enregistrement de la position.");
        }
      });
    }

    function getUserLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((position) => {
          userPosition = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
        });
      } else {
        alert("La géolocalisation n'est pas supportée.");
      }
    }

    window.onload = getUserLocation;
  </script>
</head>
<body>
  <button onclick="markBusArrival()">Bus Arrivé</button>
</body>
</html>
